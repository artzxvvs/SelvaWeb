{% extends "base.html" %}
{% load static %}

{% block title %}SelvaCore — Portfólio de Jogos{% endblock %}

{% block content %}
  <section class="home-hero" aria-labelledby="hero-title">
    <div>
      <p class="hero-kicker">SelvaCore Studios</p>
      <h1 class="hero-title" id="hero-title">
        {% if featured_game %}
          {{ featured_game.title }}
        {% else %}
          A selva pulsa com novos mundos
        {% endif %}
      </h1>
      <p class="hero-text">
        {% if featured_game and featured_game.tagline %}
          {{ featured_game.tagline }}
        {% else %}
          Experiências autorais com DNA de selva: sistemas vivos, combate visceral e histórias
          cinematográficas criadas para plataformas cruzadas.
        {% endif %}
      </p>
      <div class="hero-actions">
        <a class="hero-cta" href="#lancamentos">Explorar catálogo</a>
        <a class="hero-cta hero-cta--ghost" href="{% url 'landing' %}">Criar conta e participar</a>
      </div>
    </div>
    <div class="hero-feature">
      <span class="hero-feature__label">Visão</span>
      <p class="hero-feature__text">
        {% if featured_game and featured_game.short_description %}
          {{ featured_game.short_description }}
        {% else %}
          SelvaCore combina tecnologia proprietária com arte orgânica para entregar mundos que respondem às
          decisões dos jogadores.
        {% endif %}
      </p>
      <span class="hero-feature__label">Próximo passo</span>
      <p class="hero-feature__text">
        {% if upcoming_games %}
          Próximo lançamento: {{ upcoming_games.0.title }} — {{ upcoming_games.0.release_date|date:"F Y" }}.
        {% elif featured_game and featured_game.release_date %}
          Próximo marco: {{ featured_game.release_date|date:"d 'de' F 'de' Y" }}.
        {% elif unrevealed_games %}
          Incubadora ativa com {{ unrevealed_games|length }} projetos confidenciais aguardando anúncio.
        {% else %}
          Continuar desenvolvendo CapUp, trabalhando conscientização e diversão!.
        {% endif %}
      </p>
    </div>
  </section>

  {% if featured_game %}
    <section class="featured-game" id="destaque" aria-labelledby="featured-title">
      <article class="featured-card">
        <div class="featured-card__media">
          {% if featured_images and featured_images|length > 0 %}
            <div class="simple-carousel" data-autoplay="true" data-interval="3500">
              <div class="simple-carousel-track">
                {% for img in featured_images %}
                  <div class="simple-carousel-slide">
                    <img src="{{ img }}" alt="{{ featured_game.title }} - imagem {{ forloop.counter }}" />
                  </div>
                {% endfor %}
              </div>
            </div>
          {% else %}
            {% if featured_game.hero_image_url %}
              <img src="{{ featured_game.hero_image_url }}" alt="Arte destaque de {{ featured_game.title }}" />
            {% else %}
              <div class="featured-card__placeholder">{{ featured_game.title|first }}</div>
            {% endif %}
          {% endif %}
        </div>
        <div class="featured-card__body">
          <div class="badge-row">
            <span class="badge">Projeto destaque</span>
            {% if featured_game.status == 'released' %}
              <span class="badge badge--amber">Disponível agora</span>
            {% endif %}
          </div>
          <h2 class="featured-card__title" id="featured-title">{{ featured_game.title }}</h2>
          {% if featured_game.tagline %}
            <p class="featured-card__tagline">{{ featured_game.tagline }}</p>
          {% endif %}
          <div class="featured-card__meta">
            {% if featured_game.genre %}<span>{{ featured_game.genre }}</span>{% endif %}
            {% if featured_game.platforms %}<span>{{ featured_game.platforms }}</span>{% endif %}
            {% if featured_game.release_date %}
              <span>Lançamento {{ featured_game.release_date|date:"d 'de' F 'de' Y" }}</span>
            {% else %}
              <span>Lançamento em breve</span>
            {% endif %}
          </div>
          <p class="featured-card__about">
            {% if featured_game.long_description %}
              {{ featured_game.long_description|linebreaksbr }}
            {% elif featured_game.short_description %}
              {{ featured_game.short_description }}
            {% else %}
              Revelaremos mais do universo de {{ featured_game.title }} conforme avançamos pelas camadas da selva.
            {% endif %}
          </p>
          {% if featured_game.trailer_url %}
            <div class="featured-card__actions">
              <a class="hero-cta hero-cta--ghost" href="{{ featured_game.trailer_url }}" target="_blank" rel="noopener">Assistir trailer</a>
            </div>
          {% endif %}
        </div>
      </article>
    </section>
  {% endif %}

  <section id="manifesto" class="game-section" aria-labelledby="manifesto-title">
    <header class="game-section-header">
      <div>
        <h2 class="section-title" id="manifesto-title">Manifesto SelvaCore</h2>
        <p class="section-subtitle">Nossos princípios para cultivar mundos vivos e comunidades fortes.</p>
      </div>
    </header>
    <div class="pillars">
      {% for principle in studio_principles %}
        <article class="pillar">
          <h3 class="pillar__title">{{ principle.title }}</h3>
          <p class="pillar__text">{{ principle.description }}</p>
        </article>
      {% endfor %}
    </div>
  </section>

  <section class="community-preview" aria-labelledby="community-preview-title">
    <div class="community-preview__header">
      <h2 id="community-preview-title">A Selva também é comunidade</h2>
      <p>FAQ estruturado e feedbacks transparentes ajudam a guiar nosso desenvolvimento compartilhado.</p>
      <a class="hero-cta" href="{% url 'faq' %}">Abrir portal da comunidade</a>
    </div>
    <div class="community-preview__grid">
      <div class="community-preview__column">
        <h3>Perguntas em destaque</h3>
        {% if faq_highlights %}
          <ul class="community-faq-list">
            {% for entry in faq_highlights %}
              <li>
                <span class="community-faq-category">{{ entry.category.title }}</span>
                <strong>{{ entry.question }}</strong>
                <p>{{ entry.answer|truncatewords:22 }}</p>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="community-preview__empty">Cadastre FAQs no painel para apresentá-las aqui.</p>
        {% endif %}
      </div>
      <div class="community-preview__column">
        <h3>Feedbacks da floresta</h3>
        {% if community_updates %}
          <ul class="community-feedback-list">
            {% for item in community_updates %}
              <li>
                <header>
                  <span class="badge">{{ item.get_topic_display }}</span>
                  <small>{{ item.created_at|date:"d/m" }}</small>
                </header>
                <p>{{ item.short_message }}</p>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="community-preview__empty">Assim que feedbacks forem compartilhados, eles aparecerão aqui.</p>
        {% endif %}
      </div>
      <div class="community-preview__column community-preview__column--mini">
        <h3>Áreas da selva</h3>
        {% if context_related_categories %}
          <ul class="community-category-list">
            {% for category in context_related_categories %}
              <li>
                <strong>{{ category.title }}</strong>
                <p>{{ category.description|default:"Adicione uma descrição para ajudar a comunidade."|truncatewords:20 }}</p>
              </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="community-preview__empty">Crie categorias de FAQ para mapear temas estratégicos.</p>
        {% endif %}
      </div>
    </div>
  </section>

  <section id="lancamentos" class="game-section" aria-labelledby="catalogo-title">
    <header class="game-section-header">
      <div>
        <h2 class="section-title" id="catalogo-title">Catálogo SelvaCore</h2>
        <p class="section-subtitle">
          {% if has_games %}
            {{ total_games }} títulos em andamento, lançados e incubados.
          {% else %}
            Cadastre um jogo para começar a montar sua vitrine.
          {% endif %}
        </p>
      </div>
    </header>

    {% if has_games %}
      {% if upcoming_games %}
        <h3 class="section-heading">Próximos lançamentos</h3>
        <div class="game-grid">
          {% for game in upcoming_games %}
            {% include "games/partials/game_card.html" with game=game %}
          {% endfor %}
        </div>
      {% endif %}

      {% if released_games %}
        <h3 class="section-heading">Disponíveis agora</h3>
        <div class="game-grid">
          {% for game in released_games %}
            {% include "games/partials/game_card.html" with game=game highlight_status=True %}
          {% endfor %}
        </div>
      {% endif %}

      {% if unrevealed_games %}
        <h3 class="section-heading">Incubadora SelvaCore</h3>
        <div class="game-grid">
          {% for game in unrevealed_games %}
            {% include "games/partials/game_card.html" with game=game %}
          {% endfor %}
        </div>
      {% endif %}
    {% else %}
      <p class="empty-state">
        Nenhum jogo cadastrado ainda. Use o painel administrativo para registrar seu primeiro projeto,
        anexar artes e definir um cronograma.
      </p>
    {% endif %}
  </section>
{% endblock %}